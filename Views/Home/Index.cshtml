@{
    ViewData["Title"] = "Home Page";

    var eventsData = new[]
    {
        new { Id=1, Image="Images/1.jpg", Category="Concert", Location="Hà Nội", Title="THIÊN LÝ ƠI", Date="12/08/2025", Price="200.000 VNĐ" },
        new { Id=2, Image="Images/2.jpg", Category="Concert", Location="TP HCM", Title="ĐÊM NHẠC HOA", Date="15/08/2025", Price="350.000 VNĐ" },
        new { Id=3, Image="Images/images.jpg", Category="Sport", Location="Đà Nẵng", Title="GIẢI CHẠY BÃI BIỂN", Date="20/08/2025", Price="150.000 VNĐ" },
        new { Id=4, Image="Images/4.jpg", Category="Concert", Location="Hải Phòng", Title="KỊCH CỔ TÍCH", Date="25/08/2025", Price="250.000 VNĐ" },
        new { Id=5, Image="Images/5.jpg", Category="Concert", Location="Cần Thơ", Title="TRIỂN LÃM TRANH", Date="30/08/2025", Price="Free" },
        new { Id=6, Image="Images/06.jpg", Category="Concert", Location="Huế", Title="LỄ HỘI ẨM THỰC", Date="02/09/2025", Price="100.000 VNĐ" },
        new { Id=7, Image="Images/7.jpg", Category="Sport", Location="Nha Trang", Title="TOUR BIỂN ĐẢO", Date="05/09/2025", Price="1.200.000 VNĐ" },
        new { Id=8, Image="Images/8.jpg", Category="Concert", Location="Hà Nội", Title="NHẠC HỘI", Date="10/09/2025", Price="Free" }
    };
}

<div class="container">

    <div class="mb-4 text-center">
        <h3 class="fw-bold">Sự Kiện</h3>
        <span class="fs-5 fw-medium text-secondary mx-3 category-link" data-category="Concert">Concert</span>
        <span class="fs-5 fw-medium text-secondary mx-3 category-link" data-category="Sport">Sport</span>
        <span class="fs-5 fw-medium text-secondary mx-3 category-link" data-category="All">Tất cả</span>
    </div>

    <!-- Card sự kiện -->
    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-4" id="events-container">
        @foreach (var e in eventsData)
        {
            <div class="col event-item" data-category="@e.Category">
                <a asp-action="Details" class="text-decoration-none text-black" asp-controller="Event">
                    <div class="card event-card h-100 border-0 shadow-sm">
                        <div class="position-relative overflow-hidden rounded-top">
                            <img src="@e.Image" class="card-img-top img-fluid event-img" alt="@e.Title">
                        </div>
                        <div class="card-body p-3">
                            <span class="badge rounded-pill px-3 py-2 text-dark bg-pink-light">
                                @e.Category
                            </span>
                            <p class="mt-3 mb-1 text-muted small">
                                <i class="bi bi-geo-alt-fill me-1"></i> @e.Location
                            </p>
                            <h5 class="fw-bold mb-2">@e.Title</h5>
                            <p class="text-muted small mb-2">
                                <i class="bi bi-calendar-event me-1"></i> @e.Date
                            </p>
                            <p class="fw-bold text-danger mb-3">@e.Price</p>
                            <a href="javascript:void(0)"
                            class="btn btn-danger w-100 fw-bold btn-buy"
                            data-id="@e.Id"
                            data-title="@e.Title"
                            data-location="@e.Location"
                            data-date="@e.Date"
                            data-price="@e.Price"
                            data-category="@e.Category"
                            data-image="@e.Image">
                                Mua vé
                            </a>
                        </div>
                    </div>
                </a>
            </div>
        }
    </div>
</div>

<!-- Modal mua vé -->
<div class="modal fade" id="buyModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form asp-controller="Event" asp-action="BuyTicket" method="post">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="eventTitle"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <img id="eventImage" src="" alt="" class="img-fluid rounded mb-3">
          <input type="hidden" name="EventId" id="eventId">
          <p><i class="bi bi-geo-alt-fill"></i> <span id="eventLocation"></span></p>
          <p><i class="bi bi-calendar-event"></i> <span id="eventDate"></span></p>
          <p class="fw-bold text-danger" id="eventPrice"></p>
          <p><span class="badge bg-secondary" id="eventCategory"></span></p>
          <div class="mb-3">
            <label for="CustomerName" class="form-label">Tên của bạn</label>
            <input type="text" class="form-control" name="CustomerName" required>
          </div>
          <div class="mb-3">
            <label for="Quantity" class="form-label">Số lượng vé</label>
            <input type="number" class="form-control" name="Quantity" min="1" value="1" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
          <button type="submit" class="btn btn-primary">Xác nhận mua</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- CSS -->
<style>
    .event-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    .event-img {
        transition: transform 0.3s ease;
        height: 200px;
        object-fit: cover;
    }
    .event-card:hover .event-img {
        transform: scale(1.05);
    }
    .category-link {
        cursor: pointer;
        transition: color 0.3s;
    }
    .category-link:hover {
        color: #ff4081;
    }
    .bg-pink-light {
        background-color: rgba(255, 192, 203, 0.5);
    }
</style>

<!-- JS -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const categoryLinks = document.querySelectorAll('.category-link');
    const eventItems = document.querySelectorAll('.event-item');
    const buyButtons = document.querySelectorAll('.btn-buy');
    const modal = new bootstrap.Modal(document.getElementById('buyModal'));

    // Lọc sự kiện theo category
    function clearActive() {
        categoryLinks.forEach(link => {
            link.classList.remove('text-danger', 'fw-bold');
            link.classList.add('text-secondary');
        });
    }
    categoryLinks.forEach(link => {
        link.addEventListener('click', function () {
            const selectedCategory = this.getAttribute('data-category');
            clearActive();
            this.classList.remove('text-secondary');
            this.classList.add('text-danger', 'fw-bold');

            eventItems.forEach(item => {
                if (selectedCategory === 'All' || item.getAttribute('data-category') === selectedCategory) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
    document.querySelector('.category-link[data-category="All"]').click();

    // Xử lý nút mua vé
    buyButtons.forEach(btn => {
        btn.addEventListener('click', function () {
            document.getElementById('eventId').value = this.dataset.id;
            document.getElementById('eventTitle').textContent = this.dataset.title;
            document.getElementById('eventLocation').textContent = this.dataset.location;
            document.getElementById('eventDate').textContent = this.dataset.date;
            document.getElementById('eventPrice').textContent = this.dataset.price;
            document.getElementById('eventCategory').textContent = this.dataset.category;
            document.getElementById('eventImage').src = this.dataset.image;
            modal.show();
        });
    });
});
</script>
