@{
    ViewData["Title"] = "Chọn vé";
    var prices = ViewBag.Prices as Dictionary<string, decimal>;
}

<h2>Chọn vé</h2>

<div id="seat-map" style="display:grid;grid-template-columns:repeat(10,40px);gap:5px;">
    @for (char row = 'A'; row <= 'E'; row++)
    {
        for (int col = 1; col <= 10; col++)
        {
            <div class="seat available" data-seat="@($"{row}{col}")"></div>
        }
    }
</div>

<h3>Loại vé</h3>
<select id="ticketType">
    @foreach (var price in prices)
    {
        <option value="@price.Key">@price.Key - @price.Value.ToString("N0") VNĐ</option>
    }
</select>

<form asp-action="BuyTicket" method="post">
    <input type="hidden" name="EventId" value="@ViewBag.EventId" />
    <input type="hidden" name="SelectedSeats" id="selectedSeats" />
    <input type="hidden" name="TicketType" id="selectedTicketType" />
    <input type="text" name="CustomerName" placeholder="Họ tên" required />
    <button type="submit">Đặt vé</button>
</form>

<style>
    .seat {
        width: 40px;
        height: 40px;
        background: white;
        border: 1px solid gray;
        cursor: pointer;
    }
    .seat.selected { background: green; }
    .seat.booked { background: red; cursor: not-allowed; }
</style>

<script>
    let selectedSeats = [];

    document.querySelectorAll(".seat.available").forEach(seat => {
        seat.addEventListener("click", () => {
            const seatCode = seat.getAttribute("data-seat");
            if (seat.classList.contains("selected")) {
                seat.classList.remove("selected");
                selectedSeats = selectedSeats.filter(s => s !== seatCode);
            } else {
                seat.classList.add("selected");
                selectedSeats.push(seatCode);
            }
            document.getElementById("selectedSeats").value = selectedSeats.join(",");
        });
    });

    document.getElementById("ticketType").addEventListener("change", function() {
        document.getElementById("selectedTicketType").value = this.value;
    });

    // Gán mặc định loại vé ban đầu
    document.getElementById("selectedTicketType").value = document.getElementById("ticketType").value;
</script>
<script>
    // Giả lập dữ liệu ghế đã đặt
    const bookedSeats = ["A1", "A2", "B1", "C3"];
    bookedSeats.forEach(seat => {
        const seatElement = document.querySelector(`.seat[data-seat="${seat}"]`);
        if (seatElement) {
            seatElement.classList.remove("available");
            seatElement.classList.add("booked");
            seatElement.style.cursor = "not-allowed";
        }
    });